services:
# --- 1. Simulator Backend Service (Flask/Gunicorn) ---
- type: web
  name: refinery-simulator-backend
  env: python
  # Render will use the Dockerfile to build the environment
  # Build Command: This installs all dependencies from requirements.txt
  buildCommand: pip install -r requirements.txt
  # Start Command: Runs your Flask application using Gunicorn (assuming the Flask app instance is named 'app' in 'app.py')
  startCommand: gunicorn app:app
  
  # Configure environment variables specific to this service
  envVars:
  - key: PYTHONUNBUFFERED
    value: "true"
  - key: FLASK_ENV
    value: production
  # --- ADD YOUR SECRETS HERE ---
  # Example: The master password to protect API access
  - key: MASTER_PASS 
    sync: false  # Indicates this is a sensitive secret
    # NOTE: You must set the actual secure value in the Render dashboard after deployment.

# --- 2. Streamlit Data Viewer Service ---
- type: web
  name: refinery-data-viewer
  env: python
  # Streamlit uses the same dependencies installed in the buildCommand above
  # Build Command: We only need to install dependencies once.
  buildCommand: pip install -r requirements.txt
  # Start Command: Runs the Streamlit app. $PORT is set by Render dynamically.
  startCommand: streamlit run streamlit_app.py --server.port $PORT --server.enableCORS false
  
  envVars:
  - key: PYTHONUNBUFFERED
    value: "true"
  # Streamlit runs on a dynamically assigned $PORT